<!DOCTYPE html>
<html lang="tr">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Kayıt</title><link rel="stylesheet" href="styles.css"></head>
<body style="display:flex;align-items:center;justify-content:center;height:100vh">
  <div style="width:400px;background:#2f3136;padding:24px;border-radius:8px">
    <h2 style="text-transform:lowercase">kayıt ol</h2>
    <input id="regUser" placeholder="kullanıcı adı" style="width:100%;padding:12px;margin-top:8px;background:#202225;border:none;border-radius:6px;color:#fff">
    <input id="regEmail" placeholder="e-posta (opsiyonel)" style="width:100%;padding:12px;margin-top:8px;background:#202225;border:none;border-radius:6px;color:#fff">
    <input id="regPass" type="password" placeholder="şifre" style="width:100%;padding:12px;margin-top:8px;background:#202225;border:none;border-radius:6px;color:#fff">
    <button id="regBtn" class="primary" style="margin-top:12px;width:100%">kayıt ol</button>
  </div>

<script>
async function postJSON(url, body){
  const res = await fetch(url, {
    method:'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(body)
  });
  return res.json();
}

document.getElementById('regBtn').addEventListener('click', async ()=>{
  const username = document.getElementById('regUser').value.trim();
  const password = document.getElementById('regPass').value;
  if(!username || !password) return alert('kullanıcı adı ve şifre gerekli');
  try {
    const res = await postJSON('http://localhost:3001/api/auth/register', { username, password });
    if(res.token){
      localStorage.setItem('token', res.token);
      localStorage.setItem('username', res.username);
      location.href = 'chat.html';
    } else {
      alert(res.error || 'Kayıt başarısız');
    }
  } catch(e){ alert('sunucuya bağlanamadı'); }
});
</script>
</body>
</html>
